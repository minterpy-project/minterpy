
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>minterpy.utils.polynomials.newton &#8212; Minterpy 0.1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles.css?v=a88e7498" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/minterpy/utils/polynomials/newton';</script>
    <link rel="canonical" href="https://minterpy.readthedocs.io/en/latest/_modules/minterpy/utils/polynomials/newton.html" />
    <link rel="icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.1.dev1+ge5465fd" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../_static/Wordmark-color.png" class="logo__image only-light" alt="Minterpy 0.1 - Home"/>
    <img src="../../../../_static/Wordmark-color.png" class="logo__image only-dark pst-js-only" alt="Minterpy 0.1 - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../getting-started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../how-to/index.html">
    How-to
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../fundamentals/index.html">
    Fundamentals
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../api/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../contributors/index.html">
    Contributors
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/minterpy-project/minterpy" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://minterpy-project.github.io/minterpy/latest/" title="Latest Docs" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-dev fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Latest Docs</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://minterpy-project.github.io/minterpy/stable/" title="Stable Docs" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-box-open fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Stable Docs</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../getting-started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../how-to/index.html">
    How-to
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../fundamentals/index.html">
    Fundamentals
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../api/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../contributors/index.html">
    Contributors
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/minterpy-project/minterpy" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://minterpy-project.github.io/minterpy/latest/" title="Latest Docs" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-dev fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Latest Docs</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://minterpy-project.github.io/minterpy/stable/" title="Stable Docs" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-box-open fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Stable Docs</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">minterpy.utils.polynomials.newton</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for minterpy.utils.polynomials.newton</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module provides computational routines relevant to polynomials</span>
<span class="sd">in the Newton basis.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">minterpy.utils.quad</span> <span class="kn">import</span> <span class="n">gauss_leg</span>
<span class="kn">from</span> <span class="nn">minterpy.utils.verification</span> <span class="kn">import</span> <span class="n">check_dtype</span>
<span class="kn">from</span> <span class="nn">minterpy.global_settings</span> <span class="kn">import</span> <span class="n">FLOAT_DTYPE</span><span class="p">,</span> <span class="n">INT_DTYPE</span><span class="p">,</span> <span class="n">DEBUG</span>
<span class="kn">from</span> <span class="nn">minterpy.jit_compiled.newton.eval</span> <span class="kn">import</span> <span class="n">eval_newton_monomials_multiple</span>


<div class="viewcode-block" id="eval_newton_monomials">
<a class="viewcode-back" href="../../../../api/internal/utils/poly-newton.html#minterpy.utils.polynomials.newton.eval_newton_monomials">[docs]</a>
<span class="k">def</span> <span class="nf">eval_newton_monomials</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">exponents</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">generating_points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">verify_input</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">triangular</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Newton evaluation function.</span>

<span class="sd">    Compute the value of each Newton monomial on each given point. Internally it uses ``numba`` accelerated evaluation function.</span>

<span class="sd">    :param x: The points to evaluate the polynomials on.</span>
<span class="sd">    :type x: np.ndarray</span>
<span class="sd">    :param exponents: the multi indices &quot;alpha&quot; for every Newton polynomial corresponding to the exponents of this &quot;monomial&quot;</span>
<span class="sd">    :type exponents: np.ndarray</span>
<span class="sd">    :param generating_points: Nodes where the Newton polynomial lives on. (Or the points which generate these nodes?!)</span>
<span class="sd">    :type generating_points: np.ndarray</span>
<span class="sd">    :param verify_input: weather the data types of the input should be checked. Turned off by default for performance.</span>
<span class="sd">    :type verify_input: bool</span>
<span class="sd">    :param triangular: weather or not the output will be of lower triangular form. This will skip the evaluation of some values. Defaults to :class:`False`.</span>
<span class="sd">    :type triangular: bool</span>

<span class="sd">    :return: the value of each Newton polynomial on each point. The output shape is ``(k, N)``, where ``k`` is the number of points and ``N`` is the number of coeffitions of the Newton polyomial.</span>
<span class="sd">    :rtype: np.ndarray</span>

<span class="sd">    .. todo::</span>
<span class="sd">        - rename ``generation_points`` according to :class:`Grid`.</span>
<span class="sd">        - use instances of :class:`MultiIndex` and/or :class:`Grid` instead of the array representations of them.</span>
<span class="sd">        - ship this to the submodule ``newton_polynomials``.</span>
<span class="sd">        - Refactor the &quot;triangular&quot; parameter, the Newton monomials</span>
<span class="sd">          only becomes triangular if evaluated at the unisolvent nodes.</span>
<span class="sd">          So it needs a special function instead of parametrizing this function</span>
<span class="sd">          that can give a misleading result.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    eval_all_newt_polys : concrete ``numba`` accelerated implementation of polynomial evaluation in Newton base.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Assumption: query points array has been verified</span>
    <span class="n">num_monomials</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">exponents</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">num_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verify_input</span><span class="p">:</span>
        <span class="n">check_dtype</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">FLOAT_DTYPE</span><span class="p">)</span>
        <span class="n">check_dtype</span><span class="p">(</span><span class="n">exponents</span><span class="p">,</span> <span class="n">INT_DTYPE</span><span class="p">)</span>

    <span class="c1"># NOTE: the downstream numba-accelerated function does not support kwargs,</span>
    <span class="c1"># so the maximum exponent per dimension must be computed here</span>
    <span class="n">max_exponents</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">exponents</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Create placeholders for the final and intermediate results</span>
    <span class="n">result_placeholder</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_points</span><span class="p">,</span> <span class="n">num_monomials</span><span class="p">),</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT_DTYPE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">prod_placeholder</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">max_exponents</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT_DTYPE</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Compute the Newton monomials on all the query points</span>
    <span class="n">eval_newton_monomials_multiple</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">exponents</span><span class="p">,</span>
        <span class="n">generating_points</span><span class="p">,</span>
        <span class="n">max_exponents</span><span class="p">,</span>
        <span class="n">prod_placeholder</span><span class="p">,</span>
        <span class="n">result_placeholder</span><span class="p">,</span>
        <span class="n">triangular</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">result_placeholder</span></div>



<div class="viewcode-block" id="eval_newton_polynomials">
<a class="viewcode-back" href="../../../../api/internal/utils/poly-newton.html#minterpy.utils.polynomials.newton.eval_newton_polynomials">[docs]</a>
<span class="k">def</span> <span class="nf">eval_newton_polynomials</span><span class="p">(</span>
    <span class="n">xx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">coefficients</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">exponents</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">generating_points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">verify_input</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate the polynomial(s) in Newton form at multiple query points.</span>

<span class="sd">    Iterative implementation of polynomial evaluation in Newton form</span>

<span class="sd">    This version able to handle both:</span>
<span class="sd">        - list of input points x (2D input)</span>
<span class="sd">        - list of input coefficients (2D input)</span>

<span class="sd">    Here we use the notations:</span>
<span class="sd">        - ``n`` = polynomial degree</span>
<span class="sd">        - ``N`` = amount of coefficients</span>
<span class="sd">        - ``k`` = amount of points</span>
<span class="sd">        - ``p`` = amount of polynomials</span>


<span class="sd">    .. todo::</span>
<span class="sd">        - idea for improvement: make use of the sparsity of the exponent matrix and avoid iterating over the zero entries!</span>
<span class="sd">        - refac the explanation and documentation of this function.</span>
<span class="sd">        - use instances of :class:`MultiIndex` and/or :class:`Grid` instead of the array representations of them.</span>
<span class="sd">        - ship this to the submodule ``newton_polynomials``.</span>

<span class="sd">    :param xx: Arguemnt array with shape ``(m, k)`` the ``k`` points to evaluate on with dimensionality ``m``.</span>
<span class="sd">    :type xx: np.ndarray</span>
<span class="sd">    :param coefficients: The coefficients of the Newton polynomials.</span>
<span class="sd">        NOTE: format fixed such that &#39;lagrange2newton&#39; conversion matrices can be passed</span>
<span class="sd">        as the Newton coefficients of all Lagrange monomials of a polynomial without prior transponation</span>
<span class="sd">    :type coefficients: np.ndarray, shape = (N, p)</span>
<span class="sd">    :param exponents: a multi index ``alpha`` for every Newton polynomial corresponding to the exponents of this ``monomial``</span>
<span class="sd">    :type exponents: np.ndarray, shape = (m, N)</span>
<span class="sd">    :param generating_points: Grid values for every dimension (e.g. Leja ordered Chebychev values).</span>
<span class="sd">        the values determining the locations of the hyperplanes of the interpolation grid.</span>
<span class="sd">        the ordering of the values determine the spacial distribution of interpolation nodes.</span>
<span class="sd">        (relevant for the approximation properties and the numerical stability).</span>
<span class="sd">    :type generating_points: np.ndarray, shape = (m, n+1)</span>
<span class="sd">    :param verify_input: weather the data types of the input should be checked. turned off by default for speed.</span>
<span class="sd">    :type verify_input: bool, optional</span>
<span class="sd">    :param batch_size: batch size of query points</span>
<span class="sd">    :type batch_size: int, optional</span>

<span class="sd">    :raise TypeError: If the input ``generating_points`` do not have ``dtype = float``.</span>

<span class="sd">    :return: (k, p) the value of each input polynomial at each point. TODO squeezed into the expected shape (1D if possible). Notice, format fixed such that the regression can use the result as transformation matrix without transponation</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - This method is faster than the recursive implementation of ``tree.eval_lp(...)`` for a single point and a single polynomial (1 set of coeffs):</span>
<span class="sd">        - time complexity: :math:`O(mn+mN) = O(m(n+N)) = ...`</span>
<span class="sd">        - pre-computations: :math:`O(mn)`</span>
<span class="sd">        - evaluation: :math:`O(mN)`</span>
<span class="sd">        - space complexity: :math:`O(mn)` (precomputing and storing the products)</span>
<span class="sd">        - evaluation: :math:`O(0)`</span>
<span class="sd">    - advantage:</span>
<span class="sd">        - just operating on numpy arrays, can be just-in-time (jit) compiled</span>
<span class="sd">        - can evaluate multiple polynomials without recomputing all intermediary results</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    evaluate_multiple : ``numba`` accelerated implementation which is called internally by this function.</span>
<span class="sd">    convert_eval_output: ``numba`` accelerated implementation of the output converter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the relevant data</span>
    <span class="n">verify_input</span> <span class="o">=</span> <span class="n">verify_input</span> <span class="ow">or</span> <span class="n">DEBUG</span>
    <span class="n">num_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>

    <span class="c1"># Get batch size</span>
    <span class="c1"># TODO: Verify the batch size</span>
    <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">batch_size</span> <span class="o">&gt;=</span> <span class="n">num_points</span><span class="p">:</span>
        <span class="n">newton_monomials</span> <span class="o">=</span> <span class="n">eval_newton_monomials</span><span class="p">(</span>
            <span class="n">xx</span><span class="p">,</span>
            <span class="n">exponents</span><span class="p">,</span>
            <span class="n">generating_points</span><span class="p">,</span>
            <span class="n">verify_input</span><span class="p">,</span>
            <span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">newton_monomials</span> <span class="o">@</span> <span class="n">coefficients</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Evaluate the Newton polynomials in batches</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">eval_newton_polynomials_batch</span><span class="p">(</span>
            <span class="n">xx</span><span class="p">,</span>
            <span class="n">coefficients</span><span class="p">,</span>
            <span class="n">exponents</span><span class="p">,</span>
            <span class="n">generating_points</span><span class="p">,</span>
            <span class="n">batch_size</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span></div>



<div class="viewcode-block" id="eval_newton_polynomials_batch">
<a class="viewcode-back" href="../../../../api/internal/utils/poly-newton.html#minterpy.utils.polynomials.newton.eval_newton_polynomials_batch">[docs]</a>
<span class="k">def</span> <span class="nf">eval_newton_polynomials_batch</span><span class="p">(</span>
    <span class="n">xx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">coefficients</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">exponents</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">generating_points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate the polynomial in Newton form in batches of query points.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - It is assumed that the inputs have all been verified and rectified.</span>
<span class="sd">    - It would be more expensive to evaluate smaller batch sizes</span>
<span class="sd">      but with a smaller memory footprint in any given iteration.</span>
<span class="sd">    - If memory does not permit whole evaluation of query points,</span>
<span class="sd">      consider using smaller but not the smallest batch size (i.e., not 1).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get some important numbers</span>
    <span class="n">num_points</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">coefficients</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">num_polynomials</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_polynomials</span> <span class="o">=</span> <span class="n">coefficients</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Create an output placeholder</span>
    <span class="n">results_placeholder</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_points</span><span class="p">,</span> <span class="n">num_polynomials</span><span class="p">),</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT_DTYPE</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Batch processing: evaluate the polynomials at a batch of query points</span>
    <span class="n">n_batches</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">num_points</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">remainder</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n_batches</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_batches</span><span class="p">):</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">*</span> <span class="n">batch_size</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">n_batches</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">remainder</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="n">remainder</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">batch_size</span>

        <span class="c1"># Get the current batch of query points</span>
        <span class="n">xx_batch</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">,</span> <span class="p">:]</span>
        <span class="c1"># Compute the Newton monomials for the batch</span>
        <span class="n">newton_monomials</span> <span class="o">=</span> <span class="n">eval_newton_monomials</span><span class="p">(</span>
            <span class="n">xx_batch</span><span class="p">,</span>
            <span class="n">exponents</span><span class="p">,</span>
            <span class="n">generating_points</span><span class="p">,</span>
            <span class="kc">False</span><span class="p">,</span>
            <span class="kc">False</span>
        <span class="p">)</span>

        <span class="c1"># Compute the polynomial values for the batch</span>
        <span class="n">results_placeholder</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">newton_monomials</span> <span class="o">@</span> <span class="n">coefficients</span>

    <span class="k">return</span> <span class="n">results_placeholder</span></div>



<div class="viewcode-block" id="deriv_newt_eval">
<a class="viewcode-back" href="../../../../api/internal/utils/poly-newton.html#minterpy.utils.polynomials.newton.deriv_newt_eval">[docs]</a>
<span class="k">def</span> <span class="nf">deriv_newt_eval</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">coefficients</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">exponents</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                    <span class="n">generating_points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">derivative_order_along</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate the derivative of a polynomial in the Newton form.</span>

<span class="sd">     m = spatial dimension</span>
<span class="sd">     n = polynomial degree</span>
<span class="sd">     N = number of coefficients</span>
<span class="sd">     p = number of polynomials</span>
<span class="sd">     k = number of evaluation points</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x: (k, m) the k points to evaluate on with dimensionality m.</span>
<span class="sd">    coefficients: (N, p) the coefficients of the Newton polynomial(s).</span>
<span class="sd">    exponents: (m, N) a multi index &quot;alpha&quot; for every Newton polynomial</span>
<span class="sd">        corresponding to the exponents of this &quot;monomial&quot;</span>
<span class="sd">    generating_points: (m, n+1) grid values for every dimension (e.g. Leja ordered Chebychev values).</span>
<span class="sd">    derivative_order_along: (m) specifying the order along each dimension to compute the derivative</span>
<span class="sd">    eg. [2,3,1] will compute respectively 2nd order, 3rd order, and 1st order along spatial dimensions</span>
<span class="sd">    0, 1, and 2.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (k) the value of derivative of the polynomial evaluated at each point.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Can compute derivative polynomials without transforming to canonical basis.</span>
<span class="sd">    - This derivative evaluation is done by taking derivatives of the Newton monomials.</span>
<span class="sd">    - JIT compilation using Numba was not used here as ``combinations()``</span>
<span class="sd">      from the ``itertools`` module does not work with Numba.</span>
<span class="sd">    - Due to multiple nested loops this implementation is very slow except</span>
<span class="sd">      for a small problem (small dimension and small polynomial degree).</span>

<span class="sd">    TODO</span>
<span class="sd">    ----</span>
<span class="sd">    - Refactor this initial implementation of polynomial differentiation</span>
<span class="sd">      in the Newton basis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get relevant data</span>
    <span class="c1"># N, coefficients, m, nr_points, nr_polynomials, x = \</span>
    <span class="c1">#     rectify_eval_input(x, coefficients, exponents, False)</span>
    <span class="n">num_monomials</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">exponents</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">num_points</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">coefficients</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">num_polynomials</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_polynomials</span> <span class="o">=</span> <span class="n">coefficients</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">max_exponents</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">exponents</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Result of the derivative evaluation</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_points</span><span class="p">,</span> <span class="n">num_polynomials</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT_DTYPE</span><span class="p">)</span>

    <span class="c1"># Array to store individual basis monomial evaluations</span>
    <span class="n">monomial_vals</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">num_monomials</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT_DTYPE</span><span class="p">)</span>

    <span class="n">num_prods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">max_exponents</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="c1"># Array to store products in basis monomial along each dimension</span>
    <span class="n">products</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_prods</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT_DTYPE</span><span class="p">)</span>

    <span class="c1"># Newton monomials have to be evaluated at each input point separately</span>
    <span class="k">for</span> <span class="n">point_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
        <span class="n">x_single</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">point_idx</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># Constructing the products array</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="n">max_exp_in_dim</span> <span class="o">=</span> <span class="n">max_exponents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">x_i</span> <span class="o">=</span> <span class="n">x_single</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">derivative_order_along</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># no partial derivative along this dimension</span>
                <span class="n">prod</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_exp_in_dim</span><span class="p">):</span>  <span class="c1"># O(n)</span>
                    <span class="n">p_ij</span> <span class="o">=</span> <span class="n">generating_points</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">prod</span> <span class="o">*=</span> <span class="p">(</span><span class="n">x_i</span> <span class="o">-</span> <span class="n">p_ij</span><span class="p">)</span>
                    <span class="c1"># NOTE: shift index by one</span>
                    <span class="n">exponent</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># NOTE: otherwise the result type is float</span>
                    <span class="n">products</span><span class="p">[</span><span class="n">exponent</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prod</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># take partial derivative of &#39;order&#39; along this dimension</span>

                <span class="c1"># derivative of first &#39;order&#39; newt monomials will be 0 as their degree &lt; order</span>
                <span class="n">products</span><span class="p">[:</span><span class="n">order</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

                <span class="c1"># if order of derivative larger than the degree</span>
                <span class="k">if</span> <span class="n">order</span> <span class="o">&gt;=</span> <span class="n">num_prods</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># derivative of newt monomial &#39;order&#39; will be just factorial of order</span>
                <span class="n">fact</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
                <span class="n">products</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fact</span>

                <span class="c1"># for all bigger monomials, use chain rule of differentiation to compute derivative of products</span>
                <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_exp_in_dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">combs</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">q</span><span class="o">-</span><span class="n">order</span><span class="p">)</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">combs</span><span class="p">:</span> <span class="c1"># combs is a generator for combinations</span>
                        <span class="n">prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">x_i</span> <span class="o">-</span> <span class="n">generating_points</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comb</span><span class="p">),</span> <span class="n">i</span><span class="p">])</span>
                        <span class="n">res</span> <span class="o">+=</span> <span class="n">prod</span>

                    <span class="n">res</span> <span class="o">*=</span> <span class="n">fact</span>
                    <span class="n">products</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>

        <span class="c1"># evaluate all Newton polynomials. O(Nm)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_monomials</span><span class="p">):</span>
            <span class="c1"># the exponents of each monomial (&quot;alpha&quot;)</span>
            <span class="c1"># are the indices of the products which need to be multiplied</span>
            <span class="n">newt_mon_val</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># required as multiplicative identity</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                <span class="n">exp</span> <span class="o">=</span> <span class="n">exponents</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                <span class="c1"># NOTE: an exponent of 0 should not cause a multiplication</span>
                <span class="k">if</span> <span class="n">exp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">newt_mon_val</span> <span class="o">*=</span> <span class="n">products</span><span class="p">[</span><span class="n">exp</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">order</span> <span class="o">=</span> <span class="n">derivative_order_along</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">order</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">newt_mon_val</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">monomial_vals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">newt_mon_val</span>

        <span class="n">results</span><span class="p">[</span><span class="n">point_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">monomial_vals</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">coefficients</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span></div>



<div class="viewcode-block" id="integrate_monomials_newton">
<a class="viewcode-back" href="../../../../api/internal/utils/poly-newton.html#minterpy.utils.polynomials.newton.integrate_monomials_newton">[docs]</a>
<span class="k">def</span> <span class="nf">integrate_monomials_newton</span><span class="p">(</span>
    <span class="n">exponents</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">generating_points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bounds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integrate the monomials in the Newton basis given a set of exponents.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    exponents : :class:`numpy:numpy.ndarray`</span>
<span class="sd">        A set of exponents from a multi-index set that defines the polynomial,</span>
<span class="sd">        an ``(N, M)`` array, where ``N`` is the number of exponents</span>
<span class="sd">        (multi-indices) and ``M`` is the number of spatial dimensions.</span>
<span class="sd">        The number of exponents corresponds to the number of monomials.</span>
<span class="sd">    generating_points : :class:`numpy:numpy.ndarray`</span>
<span class="sd">        A set of generating points of the interpolating polynomial,</span>
<span class="sd">        a ``(P + 1, M)`` array, where ``P`` is the maximum degree of</span>
<span class="sd">        the polynomial in any dimensions and ``M`` is the number</span>
<span class="sd">        of spatial dimensions.</span>
<span class="sd">    bounds : :class:`numpy:numpy.ndarray`</span>
<span class="sd">        The bounds (lower and upper) of the definite integration, an ``(M, 2)``</span>
<span class="sd">        array, where ``M`` is the number of spatial dimensions.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :class:`numpy:numpy.ndarray`</span>
<span class="sd">        The integrated Newton monomials, an ``(N,)`` array, where N is</span>
<span class="sd">        the number of monomials (exponents).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- Get some basic data</span>
    <span class="n">num_monomials</span><span class="p">,</span> <span class="n">num_dim</span> <span class="o">=</span> <span class="n">exponents</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">max_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">exponents</span><span class="p">)</span>
    <span class="n">max_exps_in_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">exponents</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># --- Compute the integrals of one-dimensional bases</span>
    <span class="n">one_dim_integrals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">max_exp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_dim</span><span class="p">))</span>  <span class="c1"># A lookup table</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_dim</span><span class="p">):</span>
        <span class="n">max_exp_in_dim</span> <span class="o">=</span> <span class="n">max_exps_in_dim</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">exponents_1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">max_exp_in_dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">generating_points_in_dim</span> <span class="o">=</span> <span class="n">generating_points</span><span class="p">[:,</span> <span class="n">j</span><span class="p">][:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c1"># NOTE: Newton monomials are polynomials, Gauss-Legendre quadrature</span>
        <span class="c1">#       will be exact for degree == 2*num_points - 1.</span>
        <span class="n">quad_num_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">max_exp_in_dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Compute the integrals</span>
        <span class="c1"># NOTE: &#39;eval_newton_monomials()&#39; expects a two-dimensional array</span>
        <span class="n">one_dim_integrals</span><span class="p">[:</span> <span class="n">max_exp_in_dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">gauss_leg</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">eval_newton_monomials</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">exponents_1d</span><span class="p">,</span> <span class="n">generating_points_in_dim</span>
            <span class="p">),</span>
            <span class="n">num_points</span><span class="o">=</span><span class="n">quad_num_points</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="c1"># --- Compute integrals of the monomials (multi-dimensional basis)</span>
    <span class="n">monomials_integrals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_monomials</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_monomials</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_dim</span><span class="p">):</span>
            <span class="n">exp</span> <span class="o">=</span> <span class="n">exponents</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">out</span> <span class="o">*=</span> <span class="n">one_dim_integrals</span><span class="p">[</span><span class="n">exp</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="n">monomials_integrals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>

    <span class="c1"># TODO: The whole integration domain is assumed to be :math:`[-1, 1]^M`</span>
    <span class="c1">#       where :math:`M` is the number of spatial dimensions because</span>
    <span class="c1">#       the current interpolating polynomial itself is defined</span>
    <span class="c1">#       in that domain. This condition may be relaxed in the future</span>
    <span class="c1">#       and the implementation.</span>

    <span class="k">return</span> <span class="n">monomials_integrals</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2022, Minterpy Development Team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>